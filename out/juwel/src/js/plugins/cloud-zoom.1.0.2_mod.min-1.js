//////////////////////////////////////////////////////////////////////////////////
// Cloud Zoom V1.0.2
// (c) 2010 by R Cecco. <http://www.professorcloud.com>
// MIT License
//
// Please retain this copyright header in all versions of the software
//////////////////////////////////////////////////////////////////////////////////
(function(a){function c(c,d){var e=a("img",c);var f;var g;var h=null;var i=null;var j=null;var k=null;var l=null;var m=null;var n;var o=0;var p,q;var r=0;var s=0;var t=0;var u=0;var v=0;var w,x;var y=this,z;setTimeout(function(){if(i===null){var a=c.width();c.parent().append(b('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',a/3,a/2-a/6)).find(":last").css("opacity",.5)}},200);var A=function(){if(m!==null){m.remove();m=null}};this.removeBits=function(){if(j){j.remove();j=null}if(k){k.remove();k=null}if(l){l.remove();l=null}A();a(".cloud-zoom-loading",c.parent()).remove()};this.destroy=function(){c.data("zoom",null);if(i){i.unbind();i.remove();i=null}if(h){h.remove();h=null}this.removeBits()};this.fadedOut=function(){if(h){h.remove();h=null}this.removeBits()};this.controlLoop=function(){if(j){var a=w-e.offset().left-p*.5>>0;var b=x-e.offset().top-q*.5>>0;if(a<0){a=0}else if(a>e.outerWidth()-p){a=e.outerWidth()-p}if(b<0){b=0}else if(b>e.outerHeight()-q){b=e.outerHeight()-q}j.css({left:a,top:b});j.css("background-position",-a+"px "+ -b+"px");r=a/e.outerWidth()*n.width>>0;s=b/e.outerHeight()*n.height>>0;u+=(r-u)/d.smoothMove;t+=(s-t)/d.smoothMove;h.css("background-position",-(u>>0)+"px "+(-(t>>0)+"px"))}o=setTimeout(function(){y.controlLoop()},30)};this.init2=function(a,b){v++;if(b===1){n=a}if(v===2){this.init()}};this.init=function(){function g(f){w=f.pageX;x=f.pageY;z=f.data;if(h){h.stop(true,false);h.remove()}var g=d.adjustX,o=d.adjustY;var r=e.outerWidth();var s=e.outerHeight();var t=d.zoomWidth;var u=d.zoomHeight;if(d.zoomWidth=="auto"){t=r}if(d.zoomHeight=="auto"){u=s}var v=c.parent();switch(d.position){case"top":o-=u;break;case"right":g+=r;break;case"bottom":o+=s;break;case"left":g-=t;break;case"inside":t=r;u=s;break;default:v=a("#"+d.position);if(!v.length){v=c;g+=r;o+=s}else{t=v.innerWidth();u=v.innerHeight()}}h=v.append(b('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:10000;"></div>',g,o,t,u,n.src)).find(":last");if(e.attr("title")&&d.showTitle){h.append(b('<div class="cloud-zoom-title">%0</div>',e.attr("title"))).find(":last").css("opacity",d.titleOpacity)}if(a.browser.msie&&a.browser.version<7){m=a('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:g,top:o,zIndex:99,width:t,height:u}).insertBefore(h)}h.fadeIn(500);if(j){j.remove();j=null}p=e.outerWidth()/n.width*h.width();q=e.outerHeight()/n.height*h.height();j=c.append(b("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",p,q)).find(":last");i.css("cursor",j.css("cursor"));var y=false;if(d.tint){j.css("background",'url("'+e.attr("src")+'")');k=c.append(b('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',e.outerWidth(),e.outerHeight(),d.tint)).find(":last");k.css("opacity",d.tintOpacity);y=true;k.fadeIn(500)}if(d.softFocus){j.css("background",'url("'+e.attr("src")+'")');l=c.append(b('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',e.outerWidth()-2,e.outerHeight()-2,d.tint)).find(":last");l.css("background",'url("'+e.attr("src")+'")');l.css("opacity",.5);y=true;l.fadeIn(500)}if(!y){j.css("opacity",d.lensOpacity)}if(d.position!=="inside"){j.fadeIn(500)}z.controlLoop();return}function f(a){clearTimeout(o);if(j){j.fadeOut(299)}if(k){k.fadeOut(299)}if(l){l.fadeOut(299)}h.fadeOut(300,function(){y.fadedOut()});return false}a(".cloud-zoom-loading",c.parent()).remove();i=c.parent().append(b("<div class='mousetrap' style='background-image:url(\".\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>",e.outerWidth(),e.outerHeight(),0,0)).find(":last");i.bind("mousemove",this,function(a){w=a.pageX;x=a.pageY});if(!d.onclick){i.bind("mouseleave",this,function(a){f(a)});i.bind("mouseenter",this,function(a){g(a)})}if(d.onclick){this.startBind=function(){i.unbind("click").bind("click",this,function(b){a(this).parent().addClass("zoom-active");g(b);z.stopBind()})};this.stopBind=function(){i.unbind("click").bind("click",this,function(b){f(b);a(this).parent().removeClass("zoom-active");z.startBind()})};this.startBind()}};f=new Image;a(f).load(function(){y.init2(this,0)});f.src=e.attr("src");g=new Image;a(g).load(function(){y.init2(this,1)});g.src=c.attr("href")}function b(a){for(var b=1;b<arguments.length;b++){a=a.replace("%"+(b-1),arguments[b])}return a}a.fn.CloudZoom=function(b){try{document.execCommand("BackgroundImageCache",false,true)}catch(d){}this.each(function(){var d;a(this).css({position:"relative",display:"block"});a("img",a(this)).css({display:"block"});d=a.extend({},a.fn.CloudZoom.defaults,b);d=a.extend({},d);a(this).data("zoom",new c(a(this),d))});return this};a.fn.CloudZoom.defaults={onclick:false,zoomWidth:"auto",zoomHeight:"auto",position:"right",tint:false,tintOpacity:.5,lensOpacity:.5,softFocus:false,smoothMove:3,showTitle:false,titleOpacity:.5,adjustX:0,adjustY:0}})(jQuery)